---
name: スマホUI対応（ボトムナビゲーション）
overview: スマホ画面に対応するため、ボトムナビゲーション形式の別UIを実装し、設定画面でデスクトップUIとモバイルUIを切り替えられるようにする
todos:
  - id: pw-setup
    content: Playwrightの依存関係追加と`playwright.config.ts`、`test:e2e`スクリプトの基本セットアップを行う
    status: pending
  - id: pw-webserver
    content: Playwright設定に`webServer`を追加し、テスト実行時に開発サーバーが自動起動・停止するようにする
    status: pending
    dependencies:
      - pw-setup
  - id: pw-tasks-e2e
    content: タスクの基本フロー（作成→編集→完了＋禁止文字バリデーション）をカバーするE2Eテストを`tests/e2e/tasks.spec.ts`に実装する
    status: pending
    dependencies:
      - pw-webserver
  - id: pw-routine-e2e
    content: ルーティン＆ハビットトラッカー周りのE2Eテストを`tests/e2e/routine.spec.ts`に実装する
    status: pending
    dependencies:
      - pw-webserver
  - id: pw-daily-analyze-e2e
    content: 日次記録および分析ページ（振り返りタブ含む）のE2Eテストを追加し、入力禁止文字も含めて確認する
    status: pending
    dependencies:
      - pw-webserver
  - id: pw-docs
    content: Playwrightテストの実行方法とCI統合方針を`docs/testing/playwright.md`などにドキュメント化する
    status: pending
    dependencies:
      - pw-setup
      - pw-tasks-e2e
---

# スマホUI対応（ボトムナビゲーション）実装計画

## 概要

スマホ画面に対応するため、ボトムナビゲーション形式の別UIを実装します。設定画面でデスクトップUIとモバイルUIを切り替えられるようにします。

## 実装内容

### 1. 型定義の追加

**ファイル**: `src/types/index.ts`

- `UIMode`型を追加: `'desktop' | 'mobile'`
- `AppData`インターフェースに`uiMode?: UIMode`を追加（デフォルト: `'desktop'`）
```typescript
export type UIMode = 'desktop' | 'mobile'

export interface AppData {
  // ... 既存のフィールド
  uiMode?: UIMode
}
```


### 2. UIモード管理関数の追加

**ファイル**: `src/services/taskService.ts`

- `getUIMode(): UIMode`: 現在のUIモードを取得（デフォルト: `'desktop'`）
- `saveUIMode(mode: UIMode): void`: UIモードを保存
```typescript
export function getUIMode(): UIMode {
  const data = loadData()
  return data.uiMode || 'desktop'
}

export function saveUIMode(mode: UIMode): void {
  const data = loadData()
  data.uiMode = mode
  saveData(data)
  window.dispatchEvent(new Event('mytcc2:dataChanged'))
}
```


### 3. ボトムナビゲーションコンポーネントの作成

**ファイル**: `src/components/layout/BottomNavigation.tsx`（新規）

- 画面下部に固定表示されるナビゲーションバー
- 主要ページへのアイコンボタン（ダッシュボード、タスク、ルーティン、分析、設定など）
- アクティブなページをハイライト表示
- タッチ操作に最適化されたサイズと間隔
```typescript
interface BottomNavigationProps {
  currentPath: string
}

export default function BottomNavigation({ currentPath }: BottomNavigationProps) {
  const navigate = useNavigate()
  
  const navItems = [
    { path: '/', icon: '◈', label: 'ダッシュボード' },
    { path: '/tasks', icon: '▣', label: 'タスク' },
    { path: '/repeat-tasks', icon: '◎', label: 'ルーティン' },
    { path: '/analyze', icon: '◆', label: '分析' },
    { path: '/settings', icon: '⚙', label: '設定' },
  ]
  
  // 実装...
}
```


### 4. モバイルレイアウトコンポーネントの作成

**ファイル**: `src/components/layout/MobileLayout.tsx`（新規）

- モバイルUI用のレイアウトコンポーネント
- ヘッダー（簡略版）
- メインコンテンツエリア
- ボトムナビゲーション（固定）
```typescript
interface MobileLayoutProps {
  children: React.ReactNode
}

export default function MobileLayout({ children }: MobileLayoutProps) {
  const location = useLocation()
  const { selectedDate, goToPrevDay, goToNextDay, goToToday, isToday } = useSelectedDate()
  
  return (
    <div className="flex flex-col min-h-screen pb-20">
      {/* 簡略化されたヘッダー */}
      <header className="sticky top-0 z-30 bg-[var(--color-bg-primary)]/95 backdrop-blur-md border-b border-[var(--color-border)]">
        {/* 日付ナビゲーションなど */}
      </header>
      
      {/* メインコンテンツ */}
      <main className="flex-1 p-4">
        {children}
      </main>
      
      {/* ボトムナビゲーション */}
      <BottomNavigation currentPath={location.pathname} />
    </div>
  )
}
```


### 5. Layoutコンポーネントの修正

**ファイル**: `src/components/layout/Layout.tsx`

- `getUIMode()`を使用してUIモードを取得
- UIモードに応じて`DesktopLayout`（既存）または`MobileLayout`（新規）を表示
```typescript
export default function Layout({ children }: LayoutProps) {
  const [uiMode, setUIMode] = useState<UIMode>(() => getUIMode())
  
  useEffect(() => {
    const handleDataChange = () => {
      setUIMode(getUIMode())
    }
    window.addEventListener('mytcc2:dataChanged', handleDataChange)
    return () => window.removeEventListener('mytcc2:dataChanged', handleDataChange)
  }, [])
  
  if (uiMode === 'mobile') {
    return <MobileLayout>{children}</MobileLayout>
  }
  
  // 既存のデスクトップレイアウト
  return <DesktopLayout>{children}</DesktopLayout>
}
```


### 6. 設定画面にUI切り替えオプションを追加

**ファイル**: `src/pages/Settings.tsx`

- UIモード切り替えセクションを追加
- ラジオボタンまたはトグルスイッチで`desktop`/`mobile`を選択
- 変更時に`saveUIMode()`を呼び出し
```typescript
const [uiMode, setUIMode] = useState<UIMode>(getUIMode())

const handleUIModeChange = (mode: UIMode) => {
  setUIMode(mode)
  saveUIMode(mode)
  showNotification('UIモードを変更しました。ページをリロードしてください。', 'info')
}

// 設定画面のUIセクションに追加
<div className="card-industrial p-6">
  <h3 className="font-display text-sm font-semibold mb-4">UIモード</h3>
  <div className="space-y-3">
    <label className="flex items-center gap-3 cursor-pointer">
      <input
        type="radio"
        name="uiMode"
        value="desktop"
        checked={uiMode === 'desktop'}
        onChange={() => handleUIModeChange('desktop')}
        className="w-4 h-4 accent-[var(--color-accent)]"
      />
      <span>デスクトップUI</span>
    </label>
    <label className="flex items-center gap-3 cursor-pointer">
      <input
        type="radio"
        name="uiMode"
        value="mobile"
        checked={uiMode === 'mobile'}
        onChange={() => handleUIModeChange('mobile')}
        className="w-4 h-4 accent-[var(--color-accent)]"
      />
      <span>モバイルUI（ボトムナビゲーション）</span>
    </label>
  </div>
</div>
```


### 7. モバイルUI用のスタイル調整

**ファイル**: `src/index.css`（必要に応じて）

- ボトムナビゲーション用のスタイル
- モバイルUI用のパディング・マージン調整
- タッチ操作に最適化されたボタンサイズ

## デザイン方針

### ボトムナビゲーション

- 画面下部に固定表示（`position: fixed; bottom: 0;`）
- 背景は半透明＋ブラー効果
- アイコン＋ラベルの形式
- アクティブなページは色を変えてハイライト
- タッチ操作に最適化（最低44x44pxのタッチターゲット）

### モバイルヘッダー

- デスクトップ版より簡略化
- 日付ナビゲーションは必須機能のみ
- ロゴやページ名は必要最小限

### メインコンテンツ

- パディングを調整（`p-4`など）
- ボトムナビゲーションの高さ分の余白を確保（`pb-20`など）

## 注意事項

- UIモード変更後はページリロードを推奨（または自動リロード）
- モバイルUIでも既存の機能はすべて利用可能
- デスクトップUIとモバイルUIでデータは共有される
- レスポンシブデザインとは別物として実装（完全に別UI）

## 実装の詳細

### ボトムナビゲーションのアイテム

主要な5-6ページに絞る：

- ダッシュボード（◈）
- タスク（▣）
- ルーティン（◎）
- 分析（◆）
- 設定（⚙）

その他のページ（Wishリスト、目標など）は、メインコンテンツ内のリンクからアクセス。

### モバイルUIでのサイドバー

- モバイルUIではサイドバーを非表示
- ナビゲーションはボトムナビゲーションのみ
- 設定画面からアクセスできるページは、ボトムナビゲーションから直接アクセス可能なページのみ