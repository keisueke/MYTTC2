# MYTTC2 セルフホストガイド

## 概要

MYTTC2は、各ユーザーが自分のデータを自分で管理できるタスク管理アプリです。

データの保存方法は以下の3つから選択できます：

| 方法 | 特徴 | おすすめの人 |
|------|------|-------------|
| **LocalStorage** | ブラウザ内に保存（デフォルト） | すぐに使いたい人 |
| **GitHub同期** | GitHubリポジトリに保存 | GitHubアカウントがある人 |
| **Cloudflare同期** | Cloudflare D1に保存 | より高度な管理をしたい人 |

## データ保存方法の比較

### LocalStorage（デフォルト）

```
ブラウザ ←→ LocalStorage
```

**メリット:**
- 設定不要ですぐに使える
- インターネット接続なしでも動作

**デメリット:**
- ブラウザのデータを削除すると消える
- 他のデバイスと同期できない

### GitHub同期

```
ブラウザ ←→ GitHub API ←→ GitHubリポジトリ
```

**メリット:**
- データがGitHubに保存される（バックアップ）
- 複数デバイスで同期可能
- バージョン管理される

**デメリット:**
- GitHubアカウントが必要
- Personal Access Tokenの設定が必要

### Cloudflare同期

```
ブラウザ ←→ Cloudflare Workers ←→ D1データベース
```

**メリット:**
- 高速なデータアクセス
- 複数デバイスで同期可能
- 無料枠で十分使える

**デメリット:**
- Cloudflareアカウントが必要
- Workers + D1のデプロイが必要

## データ容量の比較

| 方法 | 容量制限 | 備考 |
|------|----------|------|
| **LocalStorage** | 約5〜10MB | ブラウザにより異なる。タスク管理には十分 |
| **GitHub同期** | 1ファイル100MB、リポジトリ5GB | 無料プラン。タスク管理には十分すぎる容量 |
| **Cloudflare D1** | 5GB | 無料プラン。500万行読み取り/日、10万行書き込み/日 |

### 実際の使用量の目安

- タスク1件: 約0.5〜1KB
- 1,000件のタスク: 約0.5〜1MB
- 10,000件のタスク: 約5〜10MB

**結論**: どの方法でも、一般的なタスク管理の用途では容量不足になることはほぼありません。

### 注意点

- **LocalStorage**: ブラウザによっては5MBを超えると警告が出る場合があります
- **GitHub**: 1ファイルが100MBを超えると保存できません（通常は問題なし）
- **Cloudflare D1**: 無料枠のリクエスト制限（10万リクエスト/日）に注意

## セットアップ手順

### 方法1: LocalStorageのみ（設定不要）

1. アプリにアクセス
2. そのまま使い始める

データはブラウザ内に自動保存されます。

### 方法2: GitHub同期

詳細は [GitHub同期セットアップガイド](./github-sync-setup.md) を参照してください。

**概要:**
1. GitHubでPersonal Access Tokenを取得
2. データ保存用のリポジトリを作成
3. アプリのSettings画面でGitHub設定を入力

### 方法3: Cloudflare同期

詳細は [Cloudflare自己デプロイガイド](./cloudflare-self-deploy.md) を参照してください。

**概要:**
1. Cloudflareアカウントを作成
2. Workers + D1をデプロイ
3. アプリのSettings画面でCloudflare設定を入力

## 自動同期について

GitHub同期またはCloudflare同期を設定すると、**自動同期機能**が有効になります。

### 動作の仕組み

1. **操作時の自動同期（デバウンス付き）**
   - タスクの追加、編集、削除などの操作を行うと、**約3秒後**に自動的に同期が実行されます
   - 連続した操作がある場合は、最後の操作から3秒待ってからまとめて同期します
   - これにより、頻繁な操作でも無駄なAPI呼び出しを抑えつつ、データを安全に保存できます

2. **終了時の同期（フェイルセーフ）**
   - ブラウザのタブを閉じる、またはページから離れる際に、未同期の変更があれば同期を試みます
   - 注意: ブラウザの制約により、この同期の完了は保証されません（ベストエフォート）

### 同期のタイミング

| タイミング | 説明 |
|-----------|------|
| データ変更後3秒 | 自動的にクラウドに同期 |
| ページ非表示時 | 未同期データがあれば同期を試行 |
| ページ離脱時 | 未同期データがあれば同期を試行（完了保証なし） |

### エラー時の動作

- 同期エラーが発生した場合、通知が表示されますがUIはブロックされません
- 次回の操作時に再度同期が試行されます
- ネットワーク接続が回復すれば、自動的に同期が完了します

### 手動同期

自動同期に加えて、Settings画面から手動で同期を実行することもできます。

- **GitHub同期**: 「今すぐ同期」ボタン
- **Cloudflare同期**: 「接続テスト」ボタン → 成功後に同期

## よくある質問

### Q: どの方法がおすすめですか？

**個人利用で手軽に使いたい場合:**
- LocalStorage または GitHub同期

**複数デバイスで使いたい場合:**
- GitHub同期 または Cloudflare同期

**データの永続性を重視する場合:**
- GitHub同期（バージョン管理あり）

### Q: 途中で保存方法を変更できますか？

はい、できます。Settings画面で新しい同期先を設定すると、ローカルのデータを新しい同期先にアップロードできます。

### Q: データは他の人に見られますか？

- **LocalStorage**: 同じブラウザを使う人のみ
- **GitHub同期**: リポジトリをPrivateにすれば自分だけ
- **Cloudflare同期**: 自分のWorkers APIにアクセスできる人のみ

### Q: 無料で使えますか？

はい、すべての方法で無料で使えます。

- GitHub: 無料プランで十分
- Cloudflare: 無料プランで十分（Workers: 10万リクエスト/日、D1: 5GB）

## トラブルシューティング

### データが消えた

1. ブラウザのキャッシュ/データを削除していないか確認
2. GitHub/Cloudflare同期を設定している場合は、同期ボタンを押してデータを取得

### 同期がうまくいかない

1. インターネット接続を確認
2. 設定画面で接続テストを実行
3. トークン/APIキーが正しいか確認

### 複数デバイスでデータが競合した

GitHub同期の場合、競合解決ダイアログが表示されます。どちらのデータを優先するか選択してください。

## 次のステップ

- [GitHub同期セットアップガイド](./github-sync-setup.md)
- [Cloudflare自己デプロイガイド](./cloudflare-self-deploy.md)

